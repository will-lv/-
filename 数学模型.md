# 假设检验

**原理    假设一件事情发生了，用统计分布确定事情发生的概率**

### 步骤

1.提出检验假设又称无效假设，符号是H0；备择假设的符号是H1.

H0：样本与总体或样本与样本间的差异是由抽样误差引起的；

H1：样本与总体或样本与样本间存在本质差异

预先设定的检验水准为0.05；当检验假设为真，但被错误地拒绝的概率，记作ɑ，通常取ɑ=0.05或ɑ=0.01（认为5%地概率为小概率事件）

选定统计方法，由样本观察值按相应地公式计算处统计量的大小，如X2值、t值等。根据资料的类型和特点

​	Z检验

​	T检验

​	卡方检验

#### **注意问题**

做假设检验之前，应注意资料本身是否有可比性（如量纲（单位）不同）

当差别有统计学意义时应注意这样的差别再实际应用中有无意义（有相关但是没有因果关系的指标）

根据资料类型和特点选用正确的假设检验方法

根据专业及经验确定是选用单侧检验还是双侧检验

判断结论时不能绝对化，应注意无论接受或拒绝检验假设，都有判断错误的可能性（此处注意的是，P值其实再很多场合不能一定相信，但目前没有更好的替代方法）

### 应用场景（AB测试）

https://www.zhihu.com/question/20045543/answer/1103961403

背景：小规模测试下，减少是错成本，提高决策效率。产品根据测试结果可以选择更好的方案，将ab测试工程化可以显著提升效率，但是大多数时候都是考分析师人肉复盘

**目的：产品改动是否提升目标指标（如转化率，ARPU值等）**

#### 流程：

**确定目标指标，这次的改动究竟想看什么，是付费率还是跳转率等**



**计算所需实验样本，样本公式根据目标指标，第一类错误数值决定。**指标转化率越低，要求的错误概率越低（0.01），所需样本越多。

样本计算公式
$$
n = (Zα/2)^2 * σ^2 / (δ^2)
$$
其中：

- n 是所需样本数量

- Zα/2 是 α/2 的 Z 分数，α 是第一类错误概率，通常取 0.05 或 0.01

- σ 是总体标准差

- δ 是预期效果差异，即实验组和对照组的均值差异

- 因此，指标转化率越低，要求的错误概率越低（0.01），所需样本越多。

  解释：

  - Zα/2 是 α/2 的 Z 分数，α 是第一类错误概率，通常取 0.05 或 0.01。α 越小，Zα/2 越大，所需样本越多。
  - σ 是总体标准差，标准差越大，样本均值与总体均值的差距越大，所需样本越多。
  - δ 是预期效果差异，即实验组和对照组的均值差异。δ 越大，样本均值与总体均值的差距越大，所需样本越少

根据实验的预期结果，大盘用户量，确定实验所需最小流量，可以通过一个网址专门计算所需样本量：www.evanmiller.org/ab-testing/sample-size.html

绝对值指标和比率指标有差别

> 绝对值指标和比率指标的区别在于，绝对值指标是指直接测量的结果，例如转化率、点击率、销售额等；比率指标是指两个指标的比值，例如转化率提升、点击率提升、销售额提升等。



**技术对流量进行切割，保证样本的随机和均匀分布，避免出现辛普森悖论**

辛普森悖论（Simpson's paradox）是指在统计学中，当对多个分组的数据进行统计分析时，可能会得出与各个分组单独分析得出的结论相反的结论。

> 辛普森悖论的典型例子是美国大学招生中，女生的录取率通常低于男生。但如果我们进一步分析，会发现在各个招生专业中，女生的录取率通常高于男生。这说明，女生在某些专业的录取率很高，而男生在另一些专业的录取率很高。如果我们只看整体的录取率，就会得出女生录取率低于男生的错误结论。
>
> 辛普森悖论的产生原因是存在干扰变量。在上述例子中，干扰变量是专业。女生在一些专业的录取率很高，而男生在另一些专业的录取率很高。如果我们不考虑专业这个干扰变量，就会得出女生录取率低于男生的错误结论。
>
> 为了避免辛普森悖论的发生，我们需要注意以下几点：
>
> - 在进行统计分析时，要考虑可能存在的干扰变量。
> - 在分析数据时，要使用多元统计方法，而不是单变量统计方法。
> - 在分析数据时，要注意数据的可靠性和有效性。



**开始实验，实验后复盘**



#### 应用中常见问题

**样本不均匀**

正确的实验方案里，除被测试的变量外，其他可能影响结果的变量的比例都应该保持一致，这就需要对流量进行均匀合理的分割

**实际样本量不足，结果不可信**

**实际样本没有被完全正交分流，无校验机制，结果不可信**

https://zhuanlan.zhihu.com/p/349530552（分流算法）

样本受时间影响较大（同一时间多策略执行），使用时间片轮转法（每隔一小时用不同的策略，消除时间差异）

**测试结果和推广结果有差异，排查过程是否有上诉问题，盘点对业务影响和回滚版本的成本，再决定是否回滚版本。如经常出现类似情况，预估测试样本量时应扩大**

**应该只观察与测试功能交互的用户的结果**

## 时间序列

背景：大部分公司分析业务数据的常见模型，主要是分析清楚时间给业务带来的变化，业务在时间下隐藏的规律，以及在时序中挖掘对策略的影响，比如是不是应该在晚上八点投消费券；以及对未来的情况做出预测

### 基础知识

**概念：**将同意统计指标地数值按其发生地时间先后顺序排列而成地数列

#### **构成要素（一般长啥样）**

**长期趋势（T）** 现象在较长时期内受某种根本性因素作用而形成地总地变动趋势

**季节变动（S）** 现象在一年内随着季节地变化而发生地有规律的周期性变动

**循环变动（C）** 现象以若干年为周期所呈现的波浪起伏形态的有规律的变动

**不规则变动（I）** 是一种无规律可循的变动，包括严格的随机变动和不规则的突发性影响很大的变动两种类型



#### 分析模型

**加法模型：**Y=T+S+C+I（Y，T计量单位相同的总量指标）（S,C,I对长期趋势产生的或正或负的偏差）

**乘法模型：**Y=T·S·C·I（常用模型）（Y，T计量单位相同的总量指标）（S,C,I对原数列指标增加或减少的百分比）



### 工作场景

#### 规律问题

利用移动平均等统计方法，告诉老板订单趋势是不是按周，按季度波动，季度和季度之间比较。如果订单下降，优先看时间上的差异。

#### 预测问题

时间和时间之间有关系，过去发生的事情，可以用简单序时平均数法、加权序时平均数法、移动平均法、加权移动平均法、趋势预测法、指数平滑法、季节性趋势预测法、市场寿命预测法等进行预测，必要的时候可以将时间数据投入机器学习中进行预测可用在目标制定的场景中



## 综合指数评价

背景：很多时候需要一个集成的指标来反应问题，进行分析，落地业务使用，就如同股票软件里面的各种指标，上证50等数字，就属于一种指数

目的：用规则模型包装集成的独立指标，可以理解为一个函数，一个公式；可以用最简单的加法乘法模型，也可以用历史数据拟合函数计算系数

#### 案例：用一个指标来评估b站创作者的质量

和业务沟通影响创作者的主要因素，策略行为等。比如发布次数，内容互动率等。

制定北极星指标，设计公式，例如将内容互动率进行分层计分，多少互动率得到多少分

指标通过专家意见或者数据分析给到权重，研究指标对其他指标的影响（例如相关性，多重共线性），例如互动率站权重50%，发布次数占10%

运用指数并修改，例如用于汇报和用户画像，或者需要算法介入，将这个 值定为目标函数，来作为机器学习的训练对象（当然，训练对象应该是直接的付费率等指标）



### 常见问题

#### 你选择什么指标来评估某结果

#### 如何从多个指标中选择合适的指标反映问题



# 归因分析

**概念：**数据分析中的归因分析是一种方法，在于去欸的那个营销活动、产品特征或其他指标对某一结果的贡献程度。它通常用于数字营销领域。

归因分析有多种方法，如**最后一次点击，线性模型和时间衰减模型。**

归因分析的目的是确定哪些因素对于用户行为或业务业绩的变化有更大的影响。在数字营销中，归因分析可以帮助企业了解哪种广告或渠道网站流量或销售量的贡献最大，从而优化**销售策略和资源投入。**



### 基础知识

#### 最后一次点击分析

（**优点：简单，缺点：无法避免其他因素对用户行为的干扰**）

收集用户最后一次的主要行为和动作，包括：主要页面的点击，跳出，付费等关键节点的行为，并且记录不同行为下的结果，比如付费金额，充值时间，流失等

将行为X与结果Y进行关联分析，针对不同的结果指标Y，计算X的贡献，比如付费三千以上的用户都习惯通过某页面进行付款等，或者看过什么内容

进一步可以通过权重进行优化，比如付费越多的用户，看某内容的行为权重更高，来分析高付费用户的偏好，进一步得出某类内容、功能对用户结果的影响



#### 线性模型

**（优点：效率和结果质量相对高，缺点：如果场景太复杂会十分）**

将上述收集的数据，包括最后一次行为和其他行为，比如前三十天的搜索次数，还有在上面没有考虑的活动、时间周期的影响（比如前三十天参加活动次数）都可以作为自变量

考虑的活动、时间周期的影响（比如前三十天参加活动次数）都可以作为自变量

建立线性模型，主要是多元线性回归模型，如果涉及分类指标较多，可以考虑采用逻辑回归模型，来计算自变量对因变量的影响权重

使用多重共线性，主要成分分析等斯洛优化模型，达到更好的拟合效果。



#### 时间衰减模型

（在线性模型中增加时间衰减函数，开发时间更长一点）

常见的时间衰减函数：

线型衰减：w(t) = 1 - kt

指数衰减（经常使用）：*w*(*t*)=exp(-\\lambda t)

幂律衰减：w(t)=(t+1)^(-\alpha)

S型衰减（生长函数）：w(t) = (t+1)^(-\alpha)






