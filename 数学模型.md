# 假设检验

**原理    假设一件事情发生了，用统计分布确定事情发生的概率**

### 步骤

1.提出检验假设又称无效假设，符号是H0；备择假设的符号是H1.

H0：样本与总体或样本与样本间的差异是由抽样误差引起的；

H1：样本与总体或样本与样本间存在本质差异

预先设定的检验水准为0.05；当检验假设为真，但被错误地拒绝的概率，记作ɑ，通常取ɑ=0.05或ɑ=0.01（认为5%地概率为小概率事件）

选定统计方法，由样本观察值按相应地公式计算处统计量的大小，如X2值、t值等。根据资料的类型和特点

​	Z检验

​	T检验

​	卡方检验

#### **注意问题**

做假设检验之前，应注意资料本身是否有可比性（如量纲（单位）不同）

当差别有统计学意义时应注意这样的差别再实际应用中有无意义（有相关但是没有因果关系的指标）

根据资料类型和特点选用正确的假设检验方法

根据专业及经验确定是选用单侧检验还是双侧检验

判断结论时不能绝对化，应注意无论接受或拒绝检验假设，都有判断错误的可能性（此处注意的是，P值其实再很多场合不能一定相信，但目前没有更好的替代方法）

### 应用场景（AB测试）

https://www.zhihu.com/question/20045543/answer/1103961403

背景：小规模测试下，减少是错成本，提高决策效率。产品根据测试结果可以选择更好的方案，将ab测试工程化可以显著提升效率，但是大多数时候都是考分析师人肉复盘

**目的：产品改动是否提升目标指标（如转化率，ARPU值等）**

#### 流程：

**确定目标指标，这次的改动究竟想看什么，是付费率还是跳转率等**



**计算所需实验样本，样本公式根据目标指标，第一类错误数值决定。**指标转化率越低，要求的错误概率越低（0.01），所需样本越多。

样本计算公式
$$
n = (Zα/2)^2 * σ^2 / (δ^2)
$$
其中：

- n 是所需样本数量

- Zα/2 是 α/2 的 Z 分数，α 是第一类错误概率，通常取 0.05 或 0.01

- σ 是总体标准差

- δ 是预期效果差异，即实验组和对照组的均值差异

- 因此，指标转化率越低，要求的错误概率越低（0.01），所需样本越多。

  解释：

  - Zα/2 是 α/2 的 Z 分数，α 是第一类错误概率，通常取 0.05 或 0.01。α 越小，Zα/2 越大，所需样本越多。
  - σ 是总体标准差，标准差越大，样本均值与总体均值的差距越大，所需样本越多。
  - δ 是预期效果差异，即实验组和对照组的均值差异。δ 越大，样本均值与总体均值的差距越大，所需样本越少

根据实验的预期结果，大盘用户量，确定实验所需最小流量，可以通过一个网址专门计算所需样本量：www.evanmiller.org/ab-testing/sample-size.html

绝对值指标和比率指标有差别

> 绝对值指标和比率指标的区别在于，绝对值指标是指直接测量的结果，例如转化率、点击率、销售额等；比率指标是指两个指标的比值，例如转化率提升、点击率提升、销售额提升等。



**技术对流量进行切割，保证样本的随机和均匀分布，避免出现辛普森悖论**

辛普森悖论（Simpson's paradox）是指在统计学中，当对多个分组的数据进行统计分析时，可能会得出与各个分组单独分析得出的结论相反的结论。

> 辛普森悖论的典型例子是美国大学招生中，女生的录取率通常低于男生。但如果我们进一步分析，会发现在各个招生专业中，女生的录取率通常高于男生。这说明，女生在某些专业的录取率很高，而男生在另一些专业的录取率很高。如果我们只看整体的录取率，就会得出女生录取率低于男生的错误结论。
>
> 辛普森悖论的产生原因是存在干扰变量。在上述例子中，干扰变量是专业。女生在一些专业的录取率很高，而男生在另一些专业的录取率很高。如果我们不考虑专业这个干扰变量，就会得出女生录取率低于男生的错误结论。
>
> 为了避免辛普森悖论的发生，我们需要注意以下几点：
>
> - 在进行统计分析时，要考虑可能存在的干扰变量。
> - 在分析数据时，要使用多元统计方法，而不是单变量统计方法。
> - 在分析数据时，要注意数据的可靠性和有效性。



**开始实验，实验后复盘**



#### 应用中常见问题

**样本不均匀**

正确的实验方案里，除被测试的变量外，其他可能影响结果的变量的比例都应该保持一致，这就需要对流量进行均匀合理的分割

**实际样本量不足，结果不可信**

**实际样本没有被完全正交分流，无校验机制，结果不可信**

https://zhuanlan.zhihu.com/p/349530552（分流算法）

样本受时间影响较大（同一时间多策略执行），使用时间片轮转法（每隔一小时用不同的策略，消除时间差异）

**测试结果和推广结果有差异，排查过程是否有上诉问题，盘点对业务影响和回滚版本的成本，再决定是否回滚版本。如经常出现类似情况，预估测试样本量时应扩大**

**应该只观察与测试功能交互的用户的结果**
